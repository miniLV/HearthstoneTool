# 炉石拔线工具 2.0

改进版炉石传说拔线工具，提供更好的用户体验和安全性。

## 新功能特点

### 🔐 安全性改进
- **Keychain密码存储**: 使用macOS Keychain安全存储管理员密码
- **自动权限管理**: 智能处理sudo权限，无需每次输入密码
- **错误处理**: 完善的错误处理和用户反馈

### 🎮 游戏体验优化
- **进程检测**: 自动检测炉石传说运行状态
- **状态指示**: 实时显示程序和游戏状态
- **智能拔线**: 只在游戏运行时允许拔线操作

### 🖥️ 界面改进
- **现代化UI**: 更美观的界面设计
- **可拖拽窗口**: 支持拖拽移动窗口位置
- **快捷键支持**: 
  - `Ctrl+D`: 执行拔线
  - `Ctrl+Q`: 退出程序
  - `Esc`: 退出程序

### ⚙️ 配置管理
- **设置界面**: 图形化配置界面
- **配置持久化**: 自动保存用户设置
- **规则组自定义**: 支持自定义Little Snitch规则组名称

## 安装指南

### 前置要求

1. **macOS系统** (10.13或更高版本)
2. **Python 3** (建议3.8+)
3. **Little Snitch** (6.0+)

### 快速安装

```bash
# 克隆项目
git clone https://github.com/yourusername/HearthstoneTool.git
cd HearthstoneTool

# 运行安装脚本
chmod +x setup.sh
./setup.sh
```

### 手动安装

1. **安装Python依赖**
   ```bash
   pip3 install -r requirements.txt
   ```

2. **设置Little Snitch规则**
   - 打开Little Snitch配置
   - 创建规则组 "HearthStone"
   - 添加规则禁止Hearthstone的所有出站连接

3. **运行程序**
   ```bash
   python3 improved_hearthstone_tool.py
   ```

## 使用说明

### 首次设置

1. 运行程序后，点击"拔线"按钮
2. 输入管理员密码（将自动保存到Keychain）
3. 程序会自动检测炉石进程状态

### 日常使用

1. 启动炉石传说
2. 运行拔线工具（窗口右下角绿点表示炉石已运行）
3. 在需要拔线时点击"拔线"按钮
4. 程序会自动执行拔线和恢复连接

### 设置选项

点击"设置"按钮可以配置：
- Little Snitch规则组名称
- 断线持续时间
- 查看快捷键说明

## 技术原理

### 拔线机制

1. **启用规则**: 激活Little Snitch规则组，阻断网络连接
2. **等待时间**: 短暂等待确保断线生效
3. **恢复连接**: 禁用规则组，恢复正常网络连接

### 安全设计

- 密码通过macOS Keychain存储，不会明文保存
- 使用sudo权限执行网络操作
- 自动检测和处理权限问题

## 故障排除

### 常见问题

1. **拔线失败**
   - 检查Little Snitch是否正确安装
   - 确认规则组名称是否正确
   - 验证管理员权限

2. **进程检测失败**
   - 确保炉石传说正在运行
   - 检查进程名称是否包含"hearthstone"

3. **权限问题**
   - 运行 `sudo -v` 验证权限
   - 重新输入管理员密码

### 调试模式

运行时加上调试参数：
```bash
python3 improved_hearthstone_tool.py --debug
```

## 更新日志

### v2.0 (当前版本)
- 新增Keychain密码存储
- 添加进程检测功能
- 改进UI界面
- 增加快捷键支持
- 完善错误处理

### v1.0 (原始版本)
- 基本拔线功能
- 简单GUI界面
- 环境变量密码存储

## 贡献指南

欢迎提交Issue和Pull Request来帮助改进这个工具。

## 免责声明

此工具仅供学习和研究使用，请合理使用游戏功能，遵守游戏规则。

## 许可证

MIT License

---

**注意**: 使用此工具可能会影响游戏体验，请在了解后果的情况下使用。